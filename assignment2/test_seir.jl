include("seir.jl")
using Test
using .Seir
using .Seir.Factors.DiscreteDistribution


@testset "Compute correct marginals for the SEIR problem" begin
    xs1 = seir_single_time_series(transition_probs=[0.95 0.05 0.0 0.0; 0.0 0.8 0.2 0.0; 0.0 0.0 0.7 0.3; 0.0 0.0 0.0 1.0]')
    ps = [ℙ(x) for x in xs1]
    @test ps[1] ≈ [0.9999970000089999, 9.999970000090004e-7, 9.999970000090004e-7, 9.999970000090004e-7] atol = 0.00001
    @test ps[2] ≈ [0.94999715000855, 0.05000064999805, 8.999973000081e-7, 1.2999961000117008e-6] atol = 0.00001
    @test ps[3] ≈ [0.9024972925081225, 0.08750037749886752, 0.010000759997720004, 1.5699952900141294e-6] atol = 0.00001
    @test ps[4] ≈ [0.8573724278827163, 0.11512516662450016, 0.024500607498177507, 0.0030017979946060144] atol = 0.00001
    @test ps[5] ≈ [0.8145038064885805, 0.13496875469373598, 0.04017545857362428, 0.010351980244059264] atol = 0.00001
    @test ps[6] ≈ [0.7737786161641514, 0.1487001940794178, 0.055116571940284194, 0.02240461781614655] atol = 0.00001
    @test ps[100] ≈ [0.006232117325052229, 0.0020773723568080884, 0.0016618977835954674, 0.9900286125345442] atol = 0.00001
    @test length(xs1) == 100
end